---
name: Notify about workflow status
description: Send Slack channel notification about workflow finish status
inputs:
  slack-webhook:
    description: "A Slack Webhook to post a notification"
    required: true

runs:
  using: "composite"
  steps:
    #- uses: technote-space/workflow-conclusion-action@v3
    - uses: 8398a7/action-slack@v3
      #if: env.WORKFLOW_CONCLUSION == 'success'
      env:
        SLACK_WEBHOOK_URL: ${{ inputs.slack-webhook }}
      if: always()
      with:
        status: custom
        fields: workflow,job,commit,repo,ref,author,took
        custom_payload: |
          {
            blocks: [
              {
                type: 'section',
                text: {
                  type: 'mrkdwn',
                  text: '${{ job.status }}' === 'success' ? ':rocket: github workflow finished with success' : ':skull_and_crossbones: github workflow failed'
                }
              },
              {
                type: 'section',
                fields: [
                  {
                    type: 'mrkdwn',
                    text: `*Author:*\n${process.env.AS_AUTHOR}`,
                  },
                  {
                    type: 'mrkdwn',
                    text: '*Environment:*\n' + (${{process.env.AS_REF}} === 'refs/heads/master' ? 'Production 1.x' : (${{process.env.AS_REF}} === 'refs/heads/dev/1.x' ? 'Production' : 'Unknown'))
                  },
                  {
                    type: 'mrkdwn',
                    text: `*message:*\n${process.env.AS_MESSAGE}`
                  },
                  {
                    type: 'mrkdwn',
                    text: `*job:*\n${process.env.AS_JOB}`
                  },
                  {
                    type: 'mrkdwn',
                    text: `*event:*\n${process.env.AS_EVENT_NAME}`
                  },
                  {
                    type: 'mrkdwn',
                    text: `*took:*\n${process.env.AS_TOOK}`
                  },
                ]
              }
            ]
          }
