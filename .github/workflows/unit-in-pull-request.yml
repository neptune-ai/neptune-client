name: unit

on:
  workflow_dispatch:
  push:
    branches-ignore:
      - master

jobs:
  test:
    timeout-minutes: 75
#    strategy:
#      fail-fast: false
#      matrix:
#        os: [ubuntu-latest]
#        python-version: ["3.7"]
#        module:
#          - "legacy"
##          - "management"
##          - "new"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Run tests
        uses: ./.github/actions/test-unit
        with:
          python-version: "3.7"
          os: ubuntu-latest
          module: "legacy"

      - name: Report
        uses: mikepenz/action-junit-report@v2
        if: always()
        with:
          report_paths: './test-results/test-unit-*.xml'
          update_check: true
          include_passed: true
