name: set_neptune_ref

on:
  workflow_call:
    inputs:
      workflow_call_input_neptune_ref:
        description: 'neptune_ref obtained from workflow call'
        required: false
        type: string
    outputs:
      neptune_ref:
        description: 'evaluated neptune_ref'
        value: ${{ jobs.set_neptune_ref.outputs.neptune_ref }}


jobs:
  set_neptune_ref:
    runs-on: ubuntu-latest
    outputs:
      neptune_ref: ${{ steps.set_neptune_ref.outputs.neptune_ref }}
    steps:
      - name: Set neptune_ref env variable
        id: set_neptune_ref
        run: |
          if [ ${{ github.event_name }} == 'schedule' ]; then
            echo "neptune_ref=${{ inputs.workflow_call_input_neptune_ref }}" >> "$GITHUB_OUTPUT"
          elif [ ${{ github.event_name }} == 'workflow_dispatch' ]; then
            echo "neptune_ref=${{ github.ref }}" >> "$GITHUB_OUTPUT"
          elif [ ${{ github.event_name }} == 'push' ]; then
            echo "neptune_ref=${{ github.ref }}" >> "$GITHUB_OUTPUT"
          else
            echo ERROR: Unknown event name ${{ github.event_name }}
            exit 1
          fi
        shell: bash
      - name: Read debug variables
        run: |
          echo "github.event_name=${{ github.event_name }}"
          echo "steps.set_neptune_ref.outputs.neptune_ref=${{ steps.set_neptune_ref.outputs.neptune_ref }}"
